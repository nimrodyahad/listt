!function(t){"use strict";function e(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t}function i(e){var i=0,o=0;if(!e)var e=t.event;return e.pageX||e.pageY?(i=e.pageX,o=e.pageY):(e.clientX||e.clientY)&&(i=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,o=e.clientY+document.body.scrollTop+document.documentElement.scrollTop),{x:i,y:o}}function o(t,e){var i=!0;return function(o){i&&(i=!1,setTimeout(function(){i=!0},e),t(o))}}function s(t,i){t&&(this.el=t,this.options=e({},this.options),e(this.options,i),this._init(),this._initEvents())}for(var n,a=0,r="webkit moz ms o".split(" "),m=t.requestAnimationFrame,c=t.cancelAnimationFrame,l=0;l<r.length&&(!m||!c);l++)n=r[l],m=m||t[n+"RequestAnimationFrame"],c=c||t[n+"CancelAnimationFrame"]||t[n+"CancelRequestAnimationFrame"];m&&c||(m=function(e,i){var o=(new Date).getTime(),s=Math.max(0,16-(o-a)),n=t.setTimeout(function(){e(o+s)},s);return a=o+s,n},c=function(e){t.clearTimeout(e)}),s.prototype.options={extraImgs:2,extraImgsScaleGrade:0,opacity:.7,customImgsOpacity:!1,bgfixed:!0,resetOnLeave:!0,movement:{perspective:1e3,translateX:-10,translateY:-10,translateZ:20,rotateX:2,rotateY:2,rotateZ:0},element:{mouseMoveWatcher:null,viewWatcher:null}},s.prototype._init=function(){this.tiltWrapper=document.createElement("div"),this.tiltWrapper.className="tilt",this.tiltImgBack=document.createElement("div"),this.tiltImgBack.className="tilt__back",this.tiltImgBack.tiltFxType="back",this.tiltImgBack.style.backgroundImage="url("+this.el.src+")",this.tiltWrapper.appendChild(this.tiltImgBack),this.options.extraImgs<1?this.imgCount=0:this.options.extraImgs>64?this.imgCount=64:this.imgCount=this.options.extraImgs,this.options.movement.perspective||(this.options.movement.perspective=0),this.imgElems=[];var t=this.imgCount;this.options.customImgsOpacity;this.options.bgfixed||(this.imgElems.push(this.tiltImgBack),++this.imgCount);for(var e=0;e<t;++e){var i=document.createElement("div");i.className="tilt__front",i.style.backgroundImage="url("+this.el.src+")",this.tiltWrapper.appendChild(i),this.imgElems.push(i)}this._initSetImagesOpacity(),this.el.parentNode.insertBefore(this.tiltWrapper,this.el),this.el.parentNode.removeChild(this.el),this._setViewWatcher(this),this._setMouseMoveWatcher(this),this._calcView(this)},s.prototype._initSetImagesOpacity=function(){if(this.options.customImgsOpacity)for(var t=0,e=this.imgElems.length;t<e;++t){var i=this.options.customImgsOpacity[t]?this.options.customImgsOpacity[t]:this.options.opacity;this.imgElems[t].style.opacity=i}else for(var t=0,e=this.imgElems.length;t<e;++t)"back"!==this.imgElems[t].tiltFxType&&(this.imgElems[t].style.opacity=this.options.opacity)},s.prototype._calcView=function(t){t.view={width:t.viewWatcher.offsetWidth,height:t.viewWatcher.offsetHeight}},s.prototype._setMouseMoveWatcher=function(t){var e=!1;if(t.options.element&&t.options.element.mouseMoveWatcher){var i=document.querySelector(t.options.element.mouseMoveWatcher);t.mouseMoveWatcher=i,e=!0}e||(t.mouseMoveWatcher=t.viewWatcher)},s.prototype._setViewWatcher=function(t){var e=!1;if(t.options.element&&t.options.element.viewWatcher){var i=document.querySelector(t.options.element.viewWatcher);i&&(t.viewWatcher=i,e=!0)}e||(t.viewWatcher=t.tiltWrapper)},s.prototype._initEvents=function(){var e=this,s=e.options.movement;e.mouseMoveWatcher.addEventListener("mousemove",function(t){m(function(){for(var o=i(t),n={left:document.body.scrollLeft+document.documentElement.scrollLeft,top:document.body.scrollTop+document.documentElement.scrollTop},a=e.tiltWrapper.getBoundingClientRect(),r={x:o.x-a.left-n.left,y:o.y-a.top-n.top},m=0,c=e.imgElems.length;m<c;++m){var l=e.imgElems[m],p=s.rotateX?(m+1)*s.rotateX/e.imgCount*2/e.view.height*r.y-(m+1)*s.rotateX/e.imgCount:0,h=s.rotateY?(m+1)*s.rotateY/e.imgCount*2/e.view.width*r.x-(m+1)*s.rotateY/e.imgCount:0,u=s.rotateZ?(m+1)*s.rotateZ/e.imgCount*2/e.view.width*r.x-(m+1)*s.rotateZ/e.imgCount:0,g=s.translateX?(m+1)*s.translateX/e.imgCount*2/e.view.width*r.x-(m+1)*s.translateX/e.imgCount:0,v=s.translateY?(m+1)*s.translateY/e.imgCount*2/e.view.height*r.y-(m+1)*s.translateY/e.imgCount:0,d=s.translateZ?(m+1)*s.translateZ/e.imgCount*2/e.view.height*r.y-(m+1)*s.translateZ/e.imgCount:0,f=1+e.options.extraImgsScaleGrade*(c-(m+1)),y=1!==f?" scale("+f+", "+f+")":"";l.style.WebkitTransform="perspective("+s.perspective+"px) translate3d("+g+"px,"+v+"px,"+d+"px) rotate3d(1,0,0,"+p+"deg) rotate3d(0,1,0,"+h+"deg) rotate3d(0,0,1,"+u+"deg)"+y,l.style.transform="perspective("+s.perspective+"px) translate3d("+g+"px,"+v+"px,"+d+"px) rotate3d(1,0,0,"+p+"deg) rotate3d(0,1,0,"+h+"deg) rotate3d(0,0,1,"+u+"deg)"+y}})}),e.options.resetOnLeave&&e.mouseMoveWatcher.addEventListener("mouseleave",function(){setTimeout(function(){for(var t=0,i=e.imgElems.length;t<i;++t){var o=e.imgElems[t];o.style.WebkitTransform="perspective("+s.perspective+"px) translate3d(0,0,0) rotate3d(1,1,1,0deg)",o.style.transform="perspective("+s.perspective+"px) translate3d(0,0,0) rotate3d(1,1,1,0deg)"}},60)}),t.addEventListener("resize",o(function(){e._calcView(e)},50))},s.prototype.init=function(){[].slice.call(document.querySelectorAll("img.tilt-effect")).forEach(function(t){new s(t,JSON.parse(t.getAttribute("data-tilt-options")))})},(new s).init(),t.TiltFx=s}(window);